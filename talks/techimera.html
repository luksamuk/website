<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Techimera</title>
<meta name="author" content="Lucas S. Vieira"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/beige.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">

<section>
<section id="slide-org1fa7450" data-background="./techimera/title.jpg">
<h2 id="org1fa7450"></h2>
<p style="font-size:1.2em;text-align:center;">
<b>Orquestração de Contêineres com Kubernetes</b>
</p>

<p>
Lucas S. Vieira
</p>

<p>
7 de outubro de 2022
</p>

</section>
</section>
<section>
<section id="slide-org58396b4" data-background="./techimera/index.jpg">
<h2 id="org58396b4">Índice</h2>
<ol>
<li>Introdução ao Kubernetes</li>
<li>Prova de Conceito</li>
<li>Deploy do Exemplo no Kubernetes</li>

</ol>

</section>
</section>
<section>
<section id="slide-org649bb52" data-background="./techimera/default.jpg">
<h2 id="org649bb52">Introdução ao Kubernetes (K8s)</h2>

<div id="org82a7cfc" class="figure">
<p><img src="./techimera/kubernetes-logo.png" alt="kubernetes-logo.png" width="300" />
</p>
</div>

</section>
<section id="slide-org3a92e10" data-background="./techimera/default.jpg">
<h3 id="org3a92e10">O que é Kubernetes?</h3>
<ul>
<li>Ferramenta criada pela Google para orquestração de contêineres.</li>
<li>Excelente para escalabilidade horizontal e gerenciamento de recursos.</li>
<li>Exige configuração minuciosa.</li>
<li>A menor unidade do K8s são os <i>Pods</i>, que abstraem <b>um ou mais contêineres</b>.</li>

</ul>

</section>
<section id="slide-org92fe5fb" data-background="./techimera/default.jpg">
<h3 id="org92fe5fb">Kubernetes vs. Docker Compose</h3>

<div id="orga4c8970" class="figure">
<p><img src="./techimera/docker-compose.png" alt="docker-compose.png" width="200" />
</p>
</div>

<ul style="font-size:0.6em;text-align:left;">
<li>Compose usa <i>Serviços</i>, Kubernetes gerencia  <i>Pods</i> através de <i>ReplicaSets</i> e
similares.</li>
<li>Kubernetes é pensado para HA.</li>
<li><i>Pods</i> são efêmeros, diferente de serviços.</li>
<li>Serviços  são  contêineres  com  configuração extra.  <i>Pods</i>  são  muito  mais
maleáveis.</li>

</ul>

</section>
<section id="slide-org2f404fd" data-background="./techimera/default.jpg">
<h3 id="org2f404fd">Kubernetes vs. Docker Swarm</h3>

<div id="orgd01a705" class="figure">
<p><img src="./techimera/docker-swarm.png" alt="docker-swarm.png" width="200" />
</p>
</div>

<ul style="font-size:0.6em;text-align:left;">
<li>Swarm leva o Compose para clusters.</li>
<li>Swarm é muito mais simples e familiar para quem usa Compose.</li>
<li>Swarm não suporta HA.</li>
<li>Pode ser necessário muito uso de ferramentas extras para configurar um cluster
com Swarm (Vagrant, Terraform, Ansible&#x2026;)</li>

</ul>

</section>
</section>
<section>
<section id="slide-org29ad13d" data-background="./techimera/default.jpg">
<h2 id="org29ad13d">Prova de Conceito</h2>

<div id="org64b97ae" class="figure">
<p><img src="./techimera/lisperati.png" alt="lisperati.png" height="300" />
</p>
</div>

</section>
<section id="slide-orgb5b63ec" data-background="./techimera/default.jpg">
<h3 id="orgb5b63ec">Tecnologias utilizadas</h3>

<div id="orgfb9b145" class="figure">
<p><img src="./techimera/lisp.png" alt="lisp.png" width="250" />
</p>
</div>

<ul style="font-size:0.8em;text-align:left;">
<li>API REST, CRUD de usuários, sem autenticação<br />
(<a href="https://github.com/luksamuk/techimera-k8s/">https://github.com/luksamuk/techimera-k8s/</a>)</li>
<li>Feita em Common Lisp, Permite debug remoto via Swank Server</li>
<li>Usa PostgreSQL 14</li>
<li>Docker Compose a título de comparação</li>

</ul>

</section>
<section id="slide-org7a3a50f" data-background="./techimera/default.jpg">
<h3 id="org7a3a50f">Imagens para Contêineres</h3>

<div id="org21816e4" class="figure">
<p><img src="./techimera/moby.webp" alt="moby.webp" width="250" />
</p>
</div>

<ul style="font-size:0.8em;text-align:left;">
<li>Imagem da aplicação, hospedada no DockerHub<br />
(<a href="https://hub.docker.com/repository/docker/luksamuk/techimera">https://hub.docker.com/repository/docker/luksamuk/techimera</a>)</li>
<li>PostgreSQL 14</li>
<li>PgAdmin4 (apenas no K8s)</li>

</ul>

</section>
<section id="slide-orga3b8b2a" data-background="./techimera/default.jpg">
<h3 id="orga3b8b2a">Kubernetes on-premise</h3>

<div id="org2093ce3" class="figure">
<p><img src="./techimera/rpi4.jpg" alt="rpi4.jpg" width="400" />
</p>
</div>

<ul style="font-size:0.6em;text-align:left;">
<li>Manjaro Linux arm64 rodando em um Raspberry Pi 4 Model B
<ul>
<li>Quad core, 8GB RAM, 64GB SD</li>

</ul></li>
<li>K3s da Rancher (<a href="https://k3s.io/">https://k3s.io/</a>)
<ul>
<li>K8s modificado  e com baixo  footprint; bom para  IoT mas também  para larga
escala</li>

</ul></li>

</ul>

</section>
<section id="slide-orgcf0da6b" data-background="./techimera/default.jpg">
<h3 id="orgcf0da6b">Utilitários</h3>

<div id="org5db9dab" class="figure">
<p><img src="./techimera/k9s.png" alt="k9s.png" width="400" />
</p>
</div>

<ul>
<li>K9s (<a href="https://k9scli.io/">https://k9scli.io/</a>) &#x2013; Ferramenta CLI para K8s</li>
<li>Kubectl &#x2013; Utilitário CLI padrão</li>
<li>DBeaver CE &#x2013; Gerenciamento de BD</li>

</ul>

</section>
</section>
<section>
<section id="slide-org71e3278" data-background="./techimera/default.jpg">
<h2 id="org71e3278">Deploy no Kubernetes</h2>
<p>
Agora, vamos provisionar o PostgreSQL, o backend, e o PgAdmin4.
</p>

<p>
Mas primeiro, vamos analisar a arquitetura desse provisionamento.
</p>

</section>
<section id="slide-org71e3278-split" data-background="./techimera/default.jpg">

<center>


<div id="orgf7e31e6" class="figure">
<p><img src="./techimera/pgsql-arq.png" alt="pgsql-arq.png" height="700" />
</p>
</div>

</center>

</section>
<section id="slide-org71e3278-split" data-background="./techimera/default.jpg">

<center>


<div id="org68c2a77" class="figure">
<p><img src="./techimera/backend-arq.png" alt="backend-arq.png" height="700" />
</p>
</div>

</center>

</section>
<section id="slide-org71e3278-split" data-background="./techimera/default.jpg">

<center>


<div id="org3e5c857" class="figure">
<p><img src="./techimera/pgadmin-arq.png" alt="pgadmin-arq.png" height="700" />
</p>
</div>

</center>

</section>
<section id="slide-org5e4d25a" data-background="./techimera/default.jpg">
<h3 id="org5e4d25a">Aplicando configurações</h3>
<p>
Temos Kubectl  instalado e a  configuração de acesso em  <code>~/.kube/config</code>, então
basta usarmos o console diretamente.
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>kubectl apply -f namespace.yml
kubectl apply -f postgresql.yml
kubectl apply -f backend.yml
kubectl apply -f pgadmin.yml
</code></pre>
</div>

</section>
<section id="slide-orgf6e1f51" data-background="./techimera/default.jpg">
<h4 id="orgf6e1f51">Fazendo requisições no backend</h4>
<p>
Para criar alguns usuários&#x2026;
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>curl -X POST <span style="color: #f5c791;">192.168.2.6:30000/user/seed</span>
</code></pre>
</div>

<p>
Para recuperar os usuários&#x2026;
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>curl <span style="color: #f5c791;">192.168.2.6:30000/user</span>
</code></pre>
</div>

</section>
<section id="slide-org051f3f5" data-background="./techimera/default.jpg">
<h3 id="org051f3f5">Port-forwarding</h3>
<p>
Podemos  acessar  um recurso  no  cluster  de  várias  formas. Para  um  serviço
ClusterIP,  podemos espelhar  a porta  de um  deployment na  nossa máquina,  por
exemplo.
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>kubectl port-forward <span style="color: #f5c791;">\</span>
        -n techimera <span style="color: #f5c791;">\</span>
        deployment/postgresql-deployment <span style="color: #f5c791;">\</span>
        <span style="color: #f5c791;">5432:5432</span>
</code></pre>
</div>

</section>
<section id="slide-orgd0bd9af" data-background="./techimera/default.jpg">
<h3 id="orgd0bd9af">Ingresses</h3>
<p>
Ingresses expõem uma aplicação através de endpoints na porta 80.
</p>

<p>
No K3s,  o gerenciador do  cluster é o  Traefik Proxy, então  temos configuração
específica para ele.
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>kubectl apply -f ingress.yml
</code></pre>
</div>

</section>
<section id="slide-orgcee90ad" data-background="./techimera/default.jpg">
<h4 id="orgcee90ad">Testando ingresses</h4>
<p>
Requisições na API:
</p>

<div class="org-src-container">

<pre  class="src src-bash"   ><code trim>curl <span style="color: #f5c791;">192.168.2.6/api/user</span>
</code></pre>
</div>

<p>
Acesso ao PgAdmin4:
</p>

<p>
<a href="http://192.168.2.6/pgadmin">http://192.168.2.6/pgadmin</a>
</p>

</section>
</section>
<section>
<section id="slide-org93d61c8" data-background="./techimera/thanks.jpg">
<h2 id="org93d61c8"></h2>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
slideNumber:false, controlsLayout:"edges",

// Optional libraries used to extend on reveal.js
dependencies: [
,
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }]

});

</script>
</body>
</html>
