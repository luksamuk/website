<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reading E-mail from Gmail on Plan 9 from Bell Labs</title>
<meta name="author" content="Lucas S. Vieira" />
<meta name="description" content="Programming, Tech, and occasional rant space by Lucas Vieira" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-22RF3F5XE0"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-22RF3F5XE0');
</script>
<link rel="stylesheet" type="text/css" href="../css/main.css" />
<link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<link id="theme-css" rel="stylesheet" type="text/css" href="../css/dark-theme.css" />
<link rel="icon" type="image/jpg" href="../img/cat-i-mage.jpg" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="../img/cat-i-mage.jpg">
<meta name="theme-color" content="#14171e">
</head>
<body>
<div id="preamble" class="status">
<h1 class="title">Reading E-mail from Gmail on Plan 9 from Bell Labs</h1><p><i>Written in Oct 06, 2020 by Lucas S. Vieira<br/><a href="mailto:alchemist@sdf.org">alchemist@sdf.org</a></i></p>
</div>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8036c27">Introduction</a>
<ul>
<li><a href="#org516fc35">Before going forward</a></li>
<li><a href="#orgbbbebf5">Achtung!</a></li>
</ul>
</li>
<li><a href="#orgc147dee">Configuring Gmail</a></li>
<li><a href="#orgcad110b">Configuring passwords</a></li>
<li><a href="#orge9d6d1c">Starting <code>upasfs</code> and receiving mail over IMAP</a>
<ul>
<li><a href="#org14b3dcc">Caveats on the <code>profile</code> script</a></li>
</ul>
</li>
<li><a href="#org35d2064">Running <code>faces</code> to see user icons</a>
<ul>
<li><a href="#org3ac7a9d">Enabling <code>riostart</code></a></li>
</ul>
</li>
<li><a href="#orgaf5d2f3">Sending e-mail over SMTP</a>
<ul>
<li><a href="#org525717b">Setting up <code>/mail/lib/rewrite</code></a></li>
<li><a href="#org446afad">Setting up SMTP server variable</a></li>
<li><a href="#org2bf0e1b">Setting up <code>/mail/lib/remotemail</code></a></li>
<li><a href="#orgf26a0ff">Fixing SMTP certificates</a></li>
<li><a href="#org579d049">Configuring mail headers</a></li>
</ul>
</li>
<li><a href="#orgec25de5">Using Acme Mail</a></li>
<li><a href="#org099ebe9">Conclusion</a></li>
</ul>
</div>
</div>

<div id="org21d989d" class="figure">
<p><img src="img/desktop_bootcamp.png" alt="desktop_bootcamp.png" />
</p>
</div>

<div id="outline-container-org8036c27" class="outline-2">
<h2 id="org8036c27">Introduction</h2>
<div class="outline-text-2" id="text-org8036c27">
<p>
Over the last  days, a Plan 9  bootcamp is taking place  at SDF.org. I
was one of the lucky people who got in, and so I and a bunch of people
were given  temporary VPS  access so  that we  can try,  experiment and
discover things about Plan 9 through remote connection.
</p>

<p>
SDF is a community that has  been operating for 35 years now, offering
free Unix  shell access  to anyone  willing to  learn more  about Unix
systems. It is  a welcoming community to both  newbies and experienced
hackers  &#x2013; in  the  best sense  of  the word.  The  users are  people
passionate about  technology in  general, who  learn about  new things
while also  leveraging the  good, old  things from  the golden  age of
computation.
</p>

<p>
In this post, I describe some of  the stuff I did to configure e-mail
reading and sending on  Plan 9. And of course, it  will be possible to
do that through Acme.
</p>
</div>

<div id="outline-container-org516fc35" class="outline-3">
<h3 id="org516fc35">Before going forward</h3>
<div class="outline-text-3" id="text-org516fc35">
<p>
This is not an introduction to Plan 9. This post is mostly directed to
hackers that may be struggling with mail support in it.
</p>

<p>
I  assume you  have some  familiarity  with <code>sam</code>.  You may  also do  it
directly  on  a  single-machine  Plan  9 box  or  through  a  <code>drawterm</code>
connection.
</p>

<p>
The described steps could also be done from text console and using <code>ed</code>,
though I  do not  recommend it;  Plan 9  is supposed  to be  much more
enjoyable to use from a graphical terminal, with a 3-button mouse.
</p>
</div>
</div>

<div id="outline-container-orgbbbebf5" class="outline-3">
<h3 id="orgbbbebf5">Achtung!</h3>
<div class="outline-text-3" id="text-orgbbbebf5">
<p>
This post is heavily inspired by the links below. They contain most of
the information to come.
</p>

<ul class="org-ul">
<li><a href="http://fqa.9front.org/fqa8.html#8.4.1.1.2">9front FQA: 8.4.1.1.2 Sending mail with Gmail</a></li>
<li><a href="https://9p.io/wiki/plan9/Mail_configuration/index.html">9p.io: Mail Configuration</a></li>
<li><a href="https://www.youtube.com/watch?v=byoznMe8ab4">YouTube:  Acme Mail  Demo</a></li>
</ul>

<p>
The last link is a video showing details on using Acme for e-mail. You
may want to see it at the end.
</p>

<p>
Let's get started.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc147dee" class="outline-2">
<h2 id="orgc147dee">Configuring Gmail</h2>
<div class="outline-text-2" id="text-orgc147dee">
<p>
First of  all, you  need to  configure your  Gmail account  for remote
access.
</p>

<p>
Go to  Gmail from a browser,  go to settings, IMAP/POP  settings, then
enable IMAP and SMTP connections.
</p>

<p>
After  that, you  will need  to allow  Gmail to  be accessed  by "less
secure   apps",  which   means   apps  that   don't  have   two-factor
authentication.      You      can      check     this      out      at
<a href="https://myaccount.google.com/lesssecureapps">https://myaccount.google.com/lesssecureapps</a>.
</p>

<p>
There seems to be  a way to use a password just  for a single program,
though  it involves  extra bureaucracy.   You will  likely find  it on
tutorials setting up Gmail for  other programs such as <code>offlineimap</code> and
<code>mbsync/isync</code>, but this is out of the scope of this post.
</p>
</div>
</div>

<div id="outline-container-orgcad110b" class="outline-2">
<h2 id="orgcad110b">Configuring passwords</h2>
<div class="outline-text-2" id="text-orgcad110b">
<p>
We need to configure  passwords so that they can be  used for IMAP and
SMTP authentication. Running these  commands instructs <code>factotum</code> to ask
you for entering the password on console.
</p>

<p>
Most people will just echo stuff  directly into <code>factotum</code>'s <code>ctl</code> file; I
deliberately chose  not to do that,  since <code>factotum</code> can prompt  us for
stuff which should not be echoed to the console in the first place.
</p>

<p>
You may  find this pattern useful  for entering passwords for  <code>ssh</code> and
<code>git</code> in the future as well.
</p>

<p>
For more info, run <code>man factotum</code>.
</p>

<div class="org-src-container">
<pre class="src src-rc">% auth/factotum -g <span style="color: #f5c791;">'proto=pass server=imap.gmail.com service=imap user=your-mail@example.com !password?'</span>
% auth/factotum -g <span style="color: #f5c791;">'proto=pass server=smtp.gmail.com service=smtp user=your.mail@example.com !password?'</span>
</pre>
</div>

<p>
Optionally, you can change those  commands slightly so that you inform
the  passwords  explicitly.  Those  commands can  be  put  on  session
initialization files, e.g.  <code>/bin/termrc.local</code> or <code>$home/lib/profile</code>, if
you  want <code>factotum</code>'s  knowledge of  your  passwords to  persist at  an
eventual reboot of your auth server:
</p>

<div class="org-src-container">
<pre class="src src-rc">auth/factotum -g <span style="color: #f5c791;">'proto=pass server=imap.gmail.com service=imap user=your.mail@example.com !password=YOURPASSWORD'</span>
auth/factotum -g <span style="color: #f5c791;">'proto=pass server=smtp.gmail.com service=smtp user=your.mail@example.com !password=YOURPASSWORD'</span>
</pre>
</div>

<p>
Obviously,  this is  not  safe  if you  want  to  keep your  passwords
encrypted.
</p>

<p>
Note that Plan  9 is not the kind  of OS which expects you  to shut it
down or reboot  it entirely, all the time. In  fact, the best approach
is to have  an auth server, responsible for managing  <code>factotum</code>, so you
just have to enter these passwords once and leave it running, managing
only that, and preferably using an encrypted file.
</p>
</div>
</div>

<div id="outline-container-orge9d6d1c" class="outline-2">
<h2 id="orge9d6d1c">Starting <code>upasfs</code> and receiving mail over IMAP</h2>
<div class="outline-text-2" id="text-orge9d6d1c">
<p>
<code>upas/fs</code> effectively mounts  a remote mailbox so that you  can see your
email locally. It supports POP3 and IMAP, with or without SSL.
</p>

<p>
We  will be  using  IMAP with  SSL.  For that,  run  this on  console,
replacing with your mail on pertinent parts:
</p>

<div class="org-src-container">
<pre class="src src-rc">% upas/fs -f /imaps/imap.gmail.com/your.mail<span style="color: #9d81ba;">@</span>example.com
</pre>
</div>

<p>
This  command is  supposed to  <b>fail</b>, giving  you an  error related  to
server certificate, more or less like this:
</p>

<pre class="example" id="org4dcef3f">
upas/fs imap: server certificate sha256=xxxx not recognized
</pre>

<p>
Copy the  <code>sha256</code> hash  fragment (including the  <code>sha256</code> part)  and tell
<code>tls</code> that it should be trusted:
</p>

<div class="org-src-container">
<pre class="src src-rc">% <span style="color: #9d81ba;">echo</span> <span style="color: #f5c791;">'x509 sha256=xxxx'</span> <span style="color: #9d81ba;">&gt;&gt;</span>/sys/lib/tls/mail
</pre>
</div>

<p>
After that, make  <code>upas/fs</code> run on startup by copying  the command above
to a  session initialization file, preferably  after starting <code>plumber</code>.
I  recommend doing  it at  file <code>$home/lib/profile</code>,  which runs  at the
beginning of every session.
</p>
</div>

<div id="outline-container-org14b3dcc" class="outline-3">
<h3 id="org14b3dcc">Caveats on the <code>profile</code> script</h3>
<div class="outline-text-3" id="text-org14b3dcc">
<p>
If  you are  using the  default <code>profile</code>  script, the  <code>upas/fs</code> starting
command can  be put at  both <code>terminal</code> and  <code>cpu</code> cases.  They  relate to
"local" connection (physical, directly using a keyboard and a mouse on
your  box) and  a "remote"  connection (from  another terminal,  using
<code>drawterm</code>).
</p>

<p>
The <code>con</code> case is just the case  for raw console, which is rather crappy
and you should not use anyways.
</p>
</div>
</div>
</div>

<div id="outline-container-org35d2064" class="outline-2">
<h2 id="org35d2064">Running <code>faces</code> to see user icons</h2>
<div class="outline-text-2" id="text-org35d2064">
<p>
We can check if it works by running <code>faces</code> on console:
</p>

<div class="org-src-container">
<pre class="src src-rc">% faces -i
</pre>
</div>

<p>
If everything  worked out,  you should see  some icons  populating the
screen. Each icon corresponds to the  user who sent a single e-mail to
you.
</p>


<div id="org740ec65" class="figure">
<p><img src="img/faces_bootcamp.png" alt="faces_bootcamp.png" />
</p>
</div>

<p>
If you right  click them, it will open a  console running <code>nedmail</code>, and
you'll  be able  to read  your  e-mail, though  this is  not the  most
comfortable way to do this. So we'll set up Acme Mail later.
</p>

<p>
Finally, if you are interested in  running <code>faces</code> on boot, you may want
to add it to your <code>$home/bin/rc/riostart</code>  script. Here's how I start it
on my box:
</p>

<div class="org-src-container">
<pre class="src src-rc">window 161,0,560,117 faces -i
</pre>
</div>
</div>

<div id="outline-container-org3ac7a9d" class="outline-3">
<h3 id="org3ac7a9d">Enabling <code>riostart</code></h3>
<div class="outline-text-3" id="text-org3ac7a9d">
<p>
It may  be the  case that  <code>riostart</code> is  disabled for  connections from
<code>drawterm</code> into you CPU server.
</p>

<p>
Make    sure   that    <code>rio</code>   invokes   the    <code>riostart</code>   script    on
<code>$home/lib/profile</code>, (specially on the <code>cpu</code> case for remote connections).
If it doesn't, you may want to replace <code>rio</code>'s startup command with:
</p>

<div class="org-src-container">
<pre class="src src-rc">rio -i riostart
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaf5d2f3" class="outline-2">
<h2 id="orgaf5d2f3">Sending e-mail over SMTP</h2>
<div class="outline-text-2" id="text-orgaf5d2f3">
<p>
Before enjoying  our mail service,  we need to  make sure that  we can
<i>send</i> mail.   For that, some extra  configuration is needed so  that we
can set up SMTP.
</p>
</div>

<div id="outline-container-org525717b" class="outline-3">
<h3 id="org525717b">Setting up <code>/mail/lib/rewrite</code></h3>
<div class="outline-text-3" id="text-org525717b">
<p>
You will  need to setup  <code>/mail/lib/rewrite</code>. When opening it,  the text
already written there  will instruct you to copy and  paste one of the
files <code>rewrite.gateway</code> or <code>rewrite.direct</code> into it.  Note that both these
files are also in <code>/mail/lib</code>.
</p>

<p>
Since we are relying on the  remote Gmail server to manage our e-mail,
copy  everything  inside  <code>rewrite.gateway</code>   into  <code>rewrite</code>.
</p>

<p>
Now,  wherever the  address  <code>YOURDOMAIN.DOM</code> is  listed  on that  file,
replace it with <code>gmail.com</code>. For example:
</p>

<pre class="example" id="org1661b75">
# append the local domain to addresses without a domain
local!"(.+)" 	   alias     \1@gmail.com
local!(.*)	   alias     \1@gmail.com
</pre>

<p>
For more information on those files and what they do, see <code>man rewrite</code>.
</p>
</div>
</div>

<div id="outline-container-org446afad" class="outline-3">
<h3 id="org446afad">Setting up SMTP server variable</h3>
<div class="outline-text-3" id="text-org446afad">
<p>
Now open <code>/lib/ndb/local</code>. At its end, define the <code>$smtp</code> variable:
</p>

<div class="org-src-container">
<pre class="src src-rc"><span style="color: #7CF083;">smtp</span><span style="color: #9d81ba;">=</span>smtp.gmail.com
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bf0e1b" class="outline-3">
<h3 id="org2bf0e1b">Setting up <code>/mail/lib/remotemail</code></h3>
<div class="outline-text-3" id="text-org2bf0e1b">
<p>
Finally, open <code>/mail/lib/remotemail</code>. This will  allow you to gateway to
your Gmail  account. This is  the script which effectively  sends your
e-mail.
</p>

<div class="org-src-container">
<pre class="src src-rc"><span style="color: #454459;"> #!/bin/rc</span>
<span style="color: #9d81ba;">shift</span>
<span style="color: #7CF083;">sender</span><span style="color: #9d81ba;">=</span>your.mail<span style="color: #9d81ba;">@</span>example.com
<span style="color: #9d81ba;">shift</span>
<span style="color: #7CF083;">addr</span><span style="color: #9d81ba;">=</span>tcp<span style="color: #e55c7a;">!</span>smtp.gmail.com<span style="color: #e55c7a;">!</span>587
<span style="color: #9d81ba;">shift</span>
<span style="color: #7CF083;">fd</span><span style="color: #9d81ba;">=</span>&#8216;{/bin/upas/aliasmail -f <span style="color: #7CF083;">$sender</span>}
<span style="color: #9d81ba;">switch</span>(<span style="color: #7CF083;">$fd</span>){
<span style="color: #9d81ba;">case</span> *.*
    <span style="color: #9d81ba;">;</span>
<span style="color: #9d81ba;">case</span> *
    <span style="color: #7CF083;">fd</span><span style="color: #9d81ba;">=</span>gmail.com
}
<span style="color: #9d81ba;">exec</span> /bin/upas/smtp -u your.mail<span style="color: #9d81ba;">@</span>example.com -a -h <span style="color: #7CF083;">$fd</span> <span style="color: #7CF083;">$addr</span> <span style="color: #7CF083;">$sender</span> $*
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf26a0ff" class="outline-3">
<h3 id="orgf26a0ff">Fixing SMTP certificates</h3>
<div class="outline-text-3" id="text-orgf26a0ff">
<p>
We are  almost done. The  only problem is that  Plan 9 still  does not
trust Gmail's SMTP server.
</p>

<p>
Try sending an example e-mail:
</p>

<div class="org-src-container">
<pre class="src src-rc">% <span style="color: #9d81ba;">echo</span> hello <span style="color: #9d81ba;">|</span> mail -s test your.username<span style="color: #9d81ba;">@</span>gmail.com
</pre>
</div>

<p>
<b>This will fail</b>, but it will  also yield a certificate error, which you
can see when you <code>cat</code> the file  <code>/sys/log/smtp</code>. It will list your IP and
the current date, and then a message like this will follow:
</p>

<pre class="example" id="org728f9ef">
cert for smtp.gmail.com not recognized: sha=xxxx
</pre>

<p>
Just like we  did with <code>upas/fs</code>, we  need to make it  trusted, but this
time we echo to a different file:
</p>

<div class="org-src-container">
<pre class="src src-rc">% <span style="color: #9d81ba;">echo</span> <span style="color: #f5c791;">'x509 sha256=xxxx'</span> <span style="color: #9d81ba;">&gt;&gt;</span>/sys/lib/tls/smtp
</pre>
</div>

<p>
You can try the command to send an e-mail again now. It should work.
</p>
</div>
</div>

<div id="outline-container-org579d049" class="outline-3">
<h3 id="org579d049">Configuring mail headers</h3>
<div class="outline-text-3" id="text-org579d049">
<p>
It is interesting  to have a header set up  with your information when
sending   a    mail.   This   can    be   done   through    the   file
<code>/mail/box/$user/headers</code>. Here is an example of what can be put there:
</p>

<pre class="example" id="orgd29d169">
From: "Glenda" &lt;your.username@gmail.com&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec25de5" class="outline-2">
<h2 id="orgec25de5">Using Acme Mail</h2>
<div class="outline-text-2" id="text-orgec25de5">
<p>
Now that  everything is set up,  we just need  to use Acme to  run its
mail client. Once  it is run, right clicks on  <code>faces</code>'s icons will just
open said mail on Acme's window.
</p>

<p>
To open Acme Mail, just write  <code>"Mail"</code> (sans the quotes) anywhere, then
middle-click it. Acme will then open  a buffer containing your list of
e-mails.
</p>


<div id="org4a135ac" class="figure">
<p><img src="img/acme_bootcamp.png" alt="acme_bootcamp.png" />
</p>
</div>

<p>
You'll  notice  that each  e-mail  has  a  numbered directory  at  its
left. Right-clicking that number will open the e-mail in a new buffer.
</p>

<p>
You  can reply  to that  e-mail by  right-clicking <code>"Reply"</code>,  quote the
e-mail by right-clicking <code>"Q"</code>, and so on.
</p>

<p>
If  you  want  to  reply  to  a  mailing  list,  you  can  select  and
middle-click  <code>"Reply  all"</code>  (or  even middle-select  <code>"Reply  all"</code>  and
release the button).
</p>

<p>
To compose new  mail, just right-click the word <code>"Mail"</code>  on top of your
mail list (not on top of Acme window!).
</p>

<p>
Composing  mail is  just  a matter  of typing  stuff  directly in  the
buffer. For example, typing this:
</p>

<pre class="example" id="orgb46bfae">
To: &lt;someone@example.com&gt;
Subject: Testing mail

Testing e-mail on Acme!
</pre>

<p>
is everything that is needed  for writing an e-mail and its metadata.
</p>

<p>
When you are done, middle-click <code>"Post"</code>, or click <code>"Del"</code> to cancel.
</p>
</div>
</div>

<div id="outline-container-org099ebe9" class="outline-2">
<h2 id="org099ebe9">Conclusion</h2>
<div class="outline-text-2" id="text-org099ebe9">
<p>
That's it  for now. This is  supposed to be a  concise tutorial; there
may be errors here and things I  did not explore. For that, I count on
the reader  to take a peek  at the links mentioned  earlier; they will
provide greater insight than anything I could ever say here.
</p>

<p>
And  if you're  a  bootcamper, don't  forget to  interact  on <code>com</code>  and
through the mailing lists!
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<h3><a href="../">Back to last page</a></h3>
</div>
</body>
</html>
